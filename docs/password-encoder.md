# 加密用户信息

 在 `digest-authentication`项目的基础上，我们构建了一个`password-encoder`项目。


## build.gradle
 
 修改 build.gradle 文件，让我们的`password-encoder`项目成为一个新的项目。

修改内容也比较简单，修改项目名称及版本即可。

```groovy
jar {
	baseName = 'password-encoder'
	version = '1.0.0'
}
```

##  MD5 算法

任何一个正式的企业应用中，都不会在数据库中使用明文来保存密码的，我们在之前的章节中都是为了方便起见没有对数据库中的用户密码进行加密，这在实际应用中是极为幼稚的做法。可以想象一下，只要有人进入数据库就可以看到所有人的密码，这是一件多么恐怖的事情，为此我们至少要对密码进行加密，这样即使数据库被攻破，也可以保证用户密码的安全。

最常用的方法是使用MD5算法对密码进行摘要加密，这是一种单项加密手段，无法通过加密后的结果反推回原来的密码明文。

首先我们要把数据库中原来保存的密码使用MD5进行加密：

```
123456  ---MD5---> e10adc3949ba59abbe56e057f20f883e
```
        
现在密码部分已经面目全非了，即使有人攻破了数据库，拿到这种“乱码”也无法登陆系统窃取客户的信息。

## 盐值加密

实际上，上面的实例在现实使用中还存在着一个不小的问题。虽然 MD5 算法是不可逆的，但是因为它对同一个字符串计算的结果是唯一的，所以一些人可能会使用“字典攻击”的方式来攻破 MD5 加密的系统。这虽然属于暴力解密，却十分有效，因为大多数系统的用户密码都不会很长。

实际上，大多数系统都是用 admin 作为默认的管理员登陆密码，所以，当我们在数据库中看到“21232f297a57a5a743894a0e4a801fc3”时，就可以意识到 admin 用户使用的密码了。因此，MD5 在处理这种常用字符串时，并不怎么奏效。

```
admin  ---MD5---> 21232f297a57a5a743894a0e4a801fc3 
```

为了解决这个问题，我们可以使用盐值加密“salt-source”。

修改配置文件：

```
```
        
在password-encoder下添加了salt-source，并且指定使用 username 作为盐值。

盐值的原理非常简单，就是先把密码和盐值指定的内容合并在一起，再使用 MD5 对合并后的内容进行演算，这样一来，就算密码是一个很常见的字符串，再加上用户名，最后算出来的 MD5 值就没那么容易猜出来了。因为攻击者不知道盐值的值，也很难反算出密码原文。

我们这里将每个用户的 username 作为盐值，最后数据库中的密码部分就变成了这样：

```
admin123456 ---MD5---> a66abb5684c45962d887564f08346e8d
```